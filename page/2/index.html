<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.igiven.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一个不专业的程序员,写着不专业的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="IGiven">
<meta property="og:url" content="http://www.igiven.com/page/2/index.html">
<meta property="og:site_name" content="IGiven">
<meta property="og:description" content="一个不专业的程序员,写着不专业的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhepama">
<meta property="article:tag" content="UNITY">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="游戏开发">
<meta property="article:tag" content="NETCORE">
<meta property="article:tag" content="JS">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="C">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.igiven.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>IGiven</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">IGiven</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一个不专业的程序员,写着不专业的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">81</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">32</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">4</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/tool-2020-06-27-linux-github-slow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/tool-2020-06-27-linux-github-slow/" class="post-title-link" itemprop="url">github下载代码的速度太慢</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-27 08:00:00" itemprop="dateCreated datePublished" datetime="2020-06-27T08:00:00+08:00">2020-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>作为程序员，最大的同性交友网站估计是大家的标配了，常常会苦恼于git clone某个项目的时候速度太慢，看着控制台那几K十一二K的速度，吐血！！</p>
<p>原因很简单：github的<a href="https://cloud.tencent.com/product/cdn?from=10680" target="_blank" rel="noopener">CDN</a>被高高的墙屏蔽所致了。 所以解决方案也很简单，就是手动把 cdn 和IP地址绑定一下。</p>
<h2 id="1、获取github地址"><a href="#1、获取github地址" class="headerlink" title="1、获取github地址"></a>1、获取github地址</h2><p>访问 <a href="http://github.com.ipaddress.com/" target="_blank" rel="noopener">http://github.com.ipaddress.com/</a> 获取cdn域名以及ip地址..或者打开 <a href="http://tool.chinaz.com/dns" target="_blank" rel="noopener">http://tool.chinaz.com/dns</a> ,这是一个查询域名映射关系的工具 </p>
<h2 id="2、获取-global-ssl-fastly地址"><a href="#2、获取-global-ssl-fastly地址" class="headerlink" title="2、获取 global.ssl.fastly地址"></a>2、获取 global.ssl.fastly地址</h2><p><a href="http://github.global.ssl.fastly.net.ipaddress.com/" target="_blank" rel="noopener">http://github.global.ssl.fastly.net.ipaddress.com/</a> 获取cdn域名以及ip地址</p>
<h2 id="3、打开hosts映射"><a href="#3、打开hosts映射" class="headerlink" title="3、打开hosts映射"></a>3、打开hosts映射</h2><h3 id="Windows环境"><a href="#Windows环境" class="headerlink" title="Windows环境"></a>Windows环境</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure>

<p>最末尾添加两句话保存:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">151.101</span><span class="number">.185</span><span class="number">.194</span> http:<span class="comment">//github.global.ssl.fastly.net </span></span><br><span class="line"><span class="number">192.30</span><span class="number">.253</span><span class="number">.112</span> http:<span class="comment">//github.com</span></span><br></pre></td></tr></table></figure>

<p>打开CMD刷新一下DNS就好了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /flushdns</span><br></pre></td></tr></table></figure>

<h3 id="Linux环境"><a href="#Linux环境" class="headerlink" title="Linux环境"></a>Linux环境</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/hosts</span><br></pre></td></tr></table></figure>

<p>添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.30</span><span class="number">.253</span><span class="number">.112</span> https:<span class="comment">//github.com</span></span><br><span class="line"><span class="number">151.101</span><span class="number">.185</span><span class="number">.194</span> https:<span class="comment">//github.global.ssl.fastly.net</span></span><br></pre></td></tr></table></figure>

<p>保存,退出,并重启网络</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<h2 id="速度对比"><a href="#速度对比" class="headerlink" title="速度对比:"></a>速度对比:</h2><p>配置前</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Receiving objects:  <span class="number">17</span>% (<span class="number">151</span>/<span class="number">883</span>), <span class="number">348.00</span> KiB | <span class="number">18.00</span> KiB/s</span><br></pre></td></tr></table></figure>

<p>配置后</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Receiving objects:  <span class="number">81</span>% (<span class="number">86141</span>/<span class="number">104384</span>), <span class="number">81.31</span>Mib | <span class="number">562.00</span> KiB/s</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/tool-2020-06-26-blog-mail-sub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/tool-2020-06-26-blog-mail-sub/" class="post-title-link" itemprop="url">为博客将 RSS 转为邮件订阅</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-26 08:00:00" itemprop="dateCreated datePublished" datetime="2020-06-26T08:00:00+08:00">2020-06-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>RSSMailer | <a href="https://link.zhihu.com/?target=https%3A//rssmailer.app/">https://rssmailer.app/</a></p>
<p>Tinyletter | <a href="https://link.zhihu.com/?target=https%3A//tinyletter.com/">tinyletter</a></p>
<p>Mailchimp| <a href="https://mailchimp.com/" target="_blank" rel="noopener">https://mailchimp.com/</a></p>
<p>相关推荐:</p>
<pre><code>- https://zhuanlan.zhihu.com/p/111978933
- https://zhuanlan.zhihu.com/p/119325491
- https://sspai.com/post/60025</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/dotnet-2020-06-11-IdentityServer-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/dotnet-2020-06-11-IdentityServer-use/" class="post-title-link" itemprop="url">IdentityServer使用指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-11 08:00:00" itemprop="dateCreated datePublished" datetime="2020-06-11T08:00:00+08:00">2020-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dotnet/" itemprop="url" rel="index"><span itemprop="name">dotnet</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>DotHass.Lobby.Domain\IdentityServer\IdentityServerDataSeedContributor.cs 中 CreateClientsAsync()</p>
<p>会在dataseed的时候生成默认数据</p>
<p>When I try to send a HTTPS POST request from a desktop (Servers are in production environment) the following message is displayed inside the console :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: unable to verify the first certificate</span><br></pre></td></tr></table></figure>

<p>After: <code>Postman -&gt; Preferences -&gt; General -&gt; SSL certificate validation -&gt; OFF</code> <strong>it works</strong></p>
<p><a href="https://localhost:5000/.well-known/openid-configuration" target="_blank" rel="noopener">https://localhost:5000/.well-known/openid-configuration</a></p>
<ol>
<li><p><a href="http://localhost:5000/connect/token" target="_blank" rel="noopener">http://localhost:5000/connect/token</a></p>
<p><img src="../../assets/images/2020-06-11-IdentityServer-use/image-20200613165200371.png" alt="image-20200613165200371"></p>
</li>
<li><p><a href="http://localhost:5000/connect/userinfo" target="_blank" rel="noopener">http://localhost:5000/connect/userinfo</a> 将type设置成bearer token,token填入上面获得的access_token</p>
</li>
</ol>
<p><img src="../../assets/images/2020-06-11-IdentityServer-use/image-20200613165246959.png" alt="image-20200613165246959"></p>
<p>3.注意发布release后.配置表中的  ..如果配置错误将会认证失败</p>
<p>appsettings.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;App&quot;: &#123;</span><br><span class="line">    &quot;SelfUrl&quot;: &quot;http:&#x2F;&#x2F;localhost:5000&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;ConnectionStrings&quot;: &#123;</span><br><span class="line">    &quot;Default&quot;: &quot;Server&#x3D;localhost;User Id&#x3D;root;Password&#x3D;123456;Database&#x3D;dothass.blog&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;AuthServer&quot;: &#123;</span><br><span class="line">    &quot;Authority&quot;: &quot;http:&#x2F;&#x2F;localhost:5000&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;IdentityServer&quot;: &#123;</span><br><span class="line">    &quot;Clients&quot;: &#123;</span><br><span class="line">      &quot;Blog_App&quot;: &#123;</span><br><span class="line">        &quot;ClientId&quot;: &quot;Blog_App&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>appsettings.Development.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;App&quot;: &#123;</span><br><span class="line">    &quot;SelfUrl&quot;: &quot;https:&#x2F;&#x2F;localhost:44377&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;AuthServer&quot;: &#123;</span><br><span class="line">    &quot;Authority&quot;: &quot;https:&#x2F;&#x2F;localhost:44377&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还要注意请求的域名是否一样,127.0.0.1或者localhost…可能返回结果即使一样.但是不能授权.</p>
<p>使用<a href="http://jwt.calebb.net/解析看下access_token" target="_blank" rel="noopener">http://jwt.calebb.net/解析看下access_token</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> alg: &quot;RS256&quot;,</span><br><span class="line"> kid: &quot;1oauLjO2TtmvAH-4A7CCLg&quot;,</span><br><span class="line"> typ: &quot;at+jwt&quot;</span><br><span class="line">&#125;.</span><br><span class="line">&#123;</span><br><span class="line"> nbf: 1592054993,</span><br><span class="line"> exp: 1623590993,</span><br><span class="line"> iss: &quot;http:&#x2F;&#x2F;127.0.0.1:5000&quot;,</span><br><span class="line"> aud: &quot;Blog&quot;,</span><br><span class="line"> client_id: &quot;Blog_App&quot;,</span><br><span class="line"> sub: &quot;fa9626f7-0f6f-6158-2afd-39f5a7f6d03f&quot;,</span><br><span class="line"> auth_time: 1592054993,</span><br><span class="line"> idp: &quot;local&quot;,</span><br><span class="line"> role: &quot;admin&quot;,</span><br><span class="line"> name: &quot;admin&quot;,</span><br><span class="line"> email: &quot;admin@abp.io&quot;,</span><br><span class="line"> email_verified: false,</span><br><span class="line"> scope: [</span><br><span class="line">  &quot;address&quot;,</span><br><span class="line">  &quot;email&quot;,</span><br><span class="line">  &quot;openid&quot;,</span><br><span class="line">  &quot;phone&quot;,</span><br><span class="line">  &quot;profile&quot;,</span><br><span class="line">  &quot;role&quot;,</span><br><span class="line">  &quot;Blog&quot;,</span><br><span class="line">  &quot;offline_access&quot;</span><br><span class="line"> ],</span><br><span class="line"> amr: [</span><br><span class="line">  &quot;pwd&quot;</span><br><span class="line"> ]</span><br><span class="line">&#125;.</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">	&#123;</span><br><span class="line"> alg: &quot;RS256&quot;,</span><br><span class="line"> kid: &quot;1oauLjO2TtmvAH-4A7CCLg&quot;,</span><br><span class="line"> typ: &quot;at+jwt&quot;</span><br><span class="line">&#125;.</span><br><span class="line">&#123;</span><br><span class="line"> nbf: 1592055396,</span><br><span class="line"> exp: 1623591396,</span><br><span class="line"> iss: &quot;http:&#x2F;&#x2F;localhost:5000&quot;,</span><br><span class="line"> aud: &quot;Blog&quot;,</span><br><span class="line"> client_id: &quot;Blog_App&quot;,</span><br><span class="line"> sub: &quot;fa9626f7-0f6f-6158-2afd-39f5a7f6d03f&quot;,</span><br><span class="line"> auth_time: 1592055396,</span><br><span class="line"> idp: &quot;local&quot;,</span><br><span class="line"> role: &quot;admin&quot;,</span><br><span class="line"> name: &quot;admin&quot;,</span><br><span class="line"> email: &quot;admin@abp.io&quot;,</span><br><span class="line"> email_verified: false,</span><br><span class="line"> scope: [</span><br><span class="line">  &quot;address&quot;,</span><br><span class="line">  &quot;email&quot;,</span><br><span class="line">  &quot;openid&quot;,</span><br><span class="line">  &quot;phone&quot;,</span><br><span class="line">  &quot;profile&quot;,</span><br><span class="line">  &quot;role&quot;,</span><br><span class="line">  &quot;Blog&quot;,</span><br><span class="line">  &quot;offline_access&quot;</span><br><span class="line"> ],</span><br><span class="line"> amr: [</span><br><span class="line">  &quot;pwd&quot;</span><br><span class="line"> ]</span><br><span class="line">&#125;.</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/dotnet-2020-05-29-abp-start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/dotnet-2020-05-29-abp-start/" class="post-title-link" itemprop="url">abp新建项目指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-29 08:00:00" itemprop="dateCreated datePublished" datetime="2020-05-29T08:00:00+08:00">2020-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dotnet/" itemprop="url" rel="index"><span itemprop="name">dotnet</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="替换数据库为mysql"><a href="#替换数据库为mysql" class="headerlink" title="替换数据库为mysql"></a>替换数据库为mysql</h1><ol>
<li>替换mysql,Dothass.Blog.EntityFrameworkCore项目中   </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PackageReference Include&#x3D;&quot;Volo.Abp.EntityFrameworkCore.MySQL&quot; Version&#x3D;&quot;2.8.0&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>删除之前的迁移目录</p>
</li>
<li><p>修改连接字符串 项目<code>Dothass.Blog.DbMigrator</code>和<code>Dothass.Blog.Web</code>..</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;详情请见https:&#x2F;&#x2F;www.connectionstrings.com&#x2F;mysql&#x2F;</span><br><span class="line">&quot;ConnectionStrings&quot;: &#123;</span><br><span class="line">   &quot;Default&quot;: server&#x3D;localhost;port&#x3D;3306;database&#x3D;dothass.blog;uid&#x3D;root;password&#x3D;123456&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成新的迁移,nuget包管理器.默认项目设置为<code>Dothass.Blog.EntityFrameworkCore.DbMigrations</code></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-Migration Init</span><br></pre></td></tr></table></figure>

<p>相关链接: <a href="https://docs.abp.io/zh-Hans/abp/latest/Entity-Framework-Core-MySQL" target="_blank" rel="noopener">https://docs.abp.io/zh-Hans/abp/latest/Entity-Framework-Core-MySQL</a></p>
<h1 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h1><ol>
<li>将三个项目copy到程序中.然后在web项目中添加依赖<code>typeof(AbpExtensionWebModule)</code>即可</li>
<li>修改migrationservice,<code>DotHass.Blog.Domain</code>项目下<code>BlogDbMigrationService</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private async Task SeedDataAsync(Tenant tenant &#x3D; null)</span><br><span class="line">&#123;</span><br><span class="line">    	Logger.LogInformation($&quot;Executing &#123;(tenant &#x3D;&#x3D; null ? &quot;host&quot; : tenant.Name + &quot; tenant&quot;)&#125; database seed...&quot;);</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F;IdentityDataSeedContributor : IDataSeedContributor ---&gt; IIdentityDataSeeder</span><br><span class="line">      &#x2F;&#x2F;手动实例化上下文,来设置admin的email和密码..或者替换IIdentityDataSeeder的service</span><br><span class="line">      var seedContext &#x3D; new DataSeedContext(tenant?.Id);</span><br><span class="line">      var configurationSection &#x3D; _configuration.GetSection(&quot;Identity&quot;);</span><br><span class="line">      seedContext.WithProperty(&quot;AdminEmail&quot;, configurationSection[&quot;AdminEmail&quot;]);</span><br><span class="line">      seedContext.WithProperty(&quot;AdminPassword&quot;, configurationSection[&quot;AdminPassword&quot;]);</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F;PermissionDataSeedContributor : IDataSeedContributor  ---&gt;IPermissionDataSeeder</span><br><span class="line">      &#x2F;&#x2F;为amidn添加权限 -- 一般来说不用改什么,但是需要在BlogDbMigratorModule中引用你设置权限的模块依赖..否则找不到你添加的权限</span><br><span class="line"></span><br><span class="line">      await _dataSeeder.SeedAsync(seedContext);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>执行项目Dothass.Blog.DbMigrator初始化数据</li>
</ol>
<h1 id="关于客户端js"><a href="#关于客户端js" class="headerlink" title="关于客户端js"></a>关于客户端js</h1><p>执行 yarn &amp; gulp 将所有包都会将自己的资源复制到wwwroot/libs文件夹中. 否则一些模块例如博客的js时不会起作用的</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/essay-2020-05-03-yang-cheng-yi-ge-xi-guan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/essay-2020-05-03-yang-cheng-yi-ge-xi-guan/" class="post-title-link" itemprop="url">如何有效的养成一个习惯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-03 08:00:00" itemprop="dateCreated datePublished" datetime="2020-05-03T08:00:00+08:00">2020-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/essay/" itemprop="url" rel="index"><span itemprop="name">essay</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="养成习惯的要点"><a href="#养成习惯的要点" class="headerlink" title="养成习惯的要点"></a>养成习惯的要点</h1><ol>
<li>习惯从简到难，一开始一定不要太难，完不成打击自信心。少即是多，慢即是快。微习惯。</li>
<li>为习惯找到好的反馈和效果，提升做下去的动力，比如跑了步，称一下瘦了五斤，这么明显，就会坚持下去</li>
<li>给予自己奖励</li>
<li>把要做的事情想象成一件快乐的事情，而不是一个麻烦，你会对做快乐的事情厌烦吗？比如早起，想到早起可以看到清晨的朝阳，上学的小朋友，出门卖早餐的小摊贩，还可以看到锻炼的美女。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/tool-2020-03-25-protobuf-Empty-Collections/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/tool-2020-03-25-protobuf-Empty-Collections/" class="post-title-link" itemprop="url">protobuf序列化的一些问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-25 08:00:00" itemprop="dateCreated datePublished" datetime="2020-03-25T08:00:00+08:00">2020-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Base-Derived-Classes"><a href="#Base-Derived-Classes" class="headerlink" title="Base / Derived Classes"></a>Base / Derived Classes</h3><p>Each derived class must have its base class marked with [ProtoInclude(<num>, typeof(ProtoBuff-Derived-Class))]. If not, all values will be NULL.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[ProtoContract]</span><br><span class="line">[ProtoInclude(100, typeof(HomeFolders))]</span><br><span class="line">[ProtoInclude(200, typeof(PublicFolders))]</span><br><span class="line">public class Folders</span><br><span class="line">&#123;</span><br><span class="line">  [ProtoMember(1)]</span><br><span class="line">  public int ProtoMember1 &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">  [ProtoMember(2)]</span><br><span class="line">  public int ProtoMember2 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[ProtoContract]</span><br><span class="line">public class HomeFolders : Folders</span><br><span class="line">&#123;</span><br><span class="line">  [ProtoMember(1)]</span><br><span class="line">  public int ProtoMember4 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[ProtoContract]</span><br><span class="line">public class PublicFolders : Folders</span><br><span class="line">&#123;</span><br><span class="line">  [ProtoMember(1)]</span><br><span class="line">  public int ProtoMember5 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Avoid-duplicate-property-tags"><a href="#Avoid-duplicate-property-tags" class="headerlink" title="Avoid duplicate property tags"></a>Avoid duplicate property tags</h3><p>Using the same number for ProtoInclude and ProtoMember will generate an error about duplicate property tags. The example below is <strong>NOT</strong> correct.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ProtoContract]</span><br><span class="line">[ProtoInclude(1, typeof(PublicFolders))]</span><br><span class="line">public class Folders</span><br><span class="line">&#123;</span><br><span class="line">  [ProtoMember(1)]</span><br><span class="line">  public int ProtoMember1 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So you need to use a different number for ProtoInclude. Corrected example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ProtoContract]</span><br><span class="line">[ProtoInclude(100, typeof(PublicFolders))]</span><br><span class="line">public class Folders</span><br><span class="line">&#123;</span><br><span class="line">  [ProtoMember(1)]</span><br><span class="line">  public int ProtoMember1 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Null-vs-Empty-Collections"><a href="#Null-vs-Empty-Collections" class="headerlink" title="Null vs. Empty Collections"></a>Null vs. Empty Collections</h3><p>ProtoBuf does not understand the difference between a collection (List, IEnumerable etc) being null versus empty (zero count). For example, if you put these objects into the cache,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;int&gt; list1 &#x3D; new List&lt;int&gt;();</span><br><span class="line">List&lt;int&gt; list2 &#x3D; null;</span><br></pre></td></tr></table></figure>

<p>after deserialization, both the lists will have the same value—that is NULL. There are two ways to solve this:</p>
<ol>
<li><p>Using a private field (we are using this):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[ProtoMember(12, OverwriteList &#x3D; true)]</span><br><span class="line">private List _publicFolders;</span><br><span class="line">public List publicFolders</span><br><span class="line">&#123;</span><br><span class="line">  get</span><br><span class="line">  &#123;</span><br><span class="line">    if (_publicFolders &#x3D;&#x3D; null)</span><br><span class="line">    &#123;</span><br><span class="line">      _publicFolders &#x3D; new List();</span><br><span class="line">    &#125;</span><br><span class="line">    return _publicFolders;</span><br><span class="line">  &#125;</span><br><span class="line">  set</span><br><span class="line">  &#123;</span><br><span class="line">    _publicFolders &#x3D; value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Using the OnDeserialized attribute:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[ProtoMember(2, OverwriteList &#x3D; true)]</span><br><span class="line">private PublicFolder[] publicFolders;</span><br><span class="line">[ProtoMember(3, OverwriteList &#x3D; true)]</span><br><span class="line">private PrivateFolder[] privateFolder;</span><br><span class="line">[ProtoMember(4, OverwriteList &#x3D; true)]</span><br><span class="line">private SecureFolder[] secureFolder;</span><br><span class="line"></span><br><span class="line">[OnDeserialized]</span><br><span class="line">private void HandleSerializationMismatch(StreamingContext context)</span><br><span class="line">&#123;</span><br><span class="line">  publicFolders &#x3D; publicFolders ?? new PublicFolders[0];</span><br><span class="line">  privateFolder &#x3D; privateFolder ?? new PrivateFolder[0];</span><br><span class="line">  secureFolder &#x3D; secureFolder ?? new SecureFolder[0];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Things-to-Remember"><a href="#Things-to-Remember" class="headerlink" title="Things to Remember"></a>Things to Remember</h3><p>ProtoBuf ignores properties if the class inherits from a collection and the Items property for that collection is null. Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Folders : List</span><br><span class="line">&#123;</span><br><span class="line">  public int value1 &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">  public int value2 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Folders folders &#x3D; new Folders() &#123; value1 &#x3D; 5; value2 &#x3D; 6; &#125;;</span><br></pre></td></tr></table></figure>

<p>After deserialization, the value of the Folders object will be NULL, because the count of items on is 0.</p>
<p>Classes that inherit from special collections are also not supported.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Folders : ReadOnlyCollection</span><br><span class="line">&#123;</span><br><span class="line">  public int value1 &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">  public int value2 &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Folders folders &#x3D; new Folders() &#123; value1 &#x3D; 5; value2 &#x3D; 6; &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="AllowParseableTypes"><a href="#AllowParseableTypes" class="headerlink" title="AllowParseableTypes"></a>AllowParseableTypes</h3><p>AllowParseableTypes is a global switch that determines whether types with “.ToString()” and “Parse(string)” methods should be serialized as strings. We can use this setting for types that can’t be marked in the ProtoContract but can be parseable.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static ProtoBufClient()</span><br><span class="line">&#123;</span><br><span class="line">  RuntimeTypeModel.Default.AllowParseableTypes &#x3D; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For example, to solve the serialization problem with the Version type:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Serializable]</span><br><span class="line">[ProtoContract(SkipConstructor &#x3D; true)]</span><br><span class="line">[ProtoInclude(100, typeof(PrivateFolder))]</span><br><span class="line">[ProtoInclude(200, typeof(PublicFolder))]</span><br><span class="line">[ProtoInclude(300, typeof(SecureFolder))]</span><br><span class="line">public abstract class FolderBase : Folder</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  [ProtoMember(3)]</span><br><span class="line">  private string name;</span><br><span class="line">  [ProtoMember(4)]</span><br><span class="line">  private Owner owner;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/unity-2020-03-04-unity-startup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/unity-2020-03-04-unity-startup/" class="post-title-link" itemprop="url">unity启动运行脚本流程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-04 08:00:00" itemprop="dateCreated datePublished" datetime="2020-03-04T08:00:00+08:00">2020-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index"><span itemprop="name">unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>性能分析：</strong></p>
<p>所有尝试优化的操作都是从发现问题开始的，在谈论性能时，这是非常重要的。对一个应用进行性能分析，第一步是根据性能分析的结果，找出它的瓶颈。然后再优化项目中的用到的技术和资源的结构。</p>
<p>提示：本节性能分析中出现的方法名称，都是从unity5.3中提取的，方法名可能在以后的Unity版本中发生变化。</p>
<p><strong>工具：</strong></p>
<p>对于unity开发者来说，性能分析的工具有很多种。Unity有一系列的内置工具，比如CPU Profiler，Memory Profiler和5.3中新加的Memory Analyzer。</p>
<p>然而最好的分析数据通常来自于特定平台的工具。其中包括：</p>
<p>IOS:Instruments和XCode Frame Debugger</p>
<p>Android:Snapdragon Profiler</p>
<p>运行因特尔CPU/GPU的平台：VTune和Intel GPA</p>
<p>PS4:Razor系列</p>
<p>Xbox：Pix工具</p>
<p>这些工具通常能分析用IL2CPP打包出来的C++项目。这些本地代码版本中，能清晰的看到堆栈调用和各类方法的执行时间，如果用Mono编译，是做不到这些的。</p>
<p>关于IOS设备上怎么进行性能分析，Unity官方有一个基本的介绍。请看：</p>
<p><a href="https://blogs.unity3d.com/cn/2016/02/01/profiling-with-instruments/%3F_ga%3D2.53202159.65875105.1532310232-165234103.1528100648" target="_blank" rel="noopener">Profiling with Instruments – Unity Blogblogs.unity3d.com!</a></p>
<p><strong>启动流程剖析：</strong></p>
<p>当查看启动流程的时间时，有两个方法需要注意。在那些影响启动时间的配置文件、资源和工程代码中，这两个方法起着重要的作用。</p>
<p>在不同的平台上，启动时间是不同的。在大多数平台上，Splash Image显示的时间，就是启动的时间。</p>
<p><img src="../../assets/images/2020-03-04-unity-startup/v2-e65aeff3106290ff9e3de0580ffa90ab_720w.jpg" alt="img"></p>
<p>上面的截图来自于在iOS设备上运行的一个示例项目。在此平台的startUnity方法中，请注意UnityInitApplicationGraphics和UnityLoadApplication方法。</p>
<p>UnityInitApplicationGraphics执行了大量的内部操作，例如设置图形设备和初始化许多Unity的内部系统。另外，为了初始化Resource系统，它必须加载Resource系统所包含下标的所有文件。每个名为“Resources”的文件夹中的每一个资源文件（注意：这只适用于项目“Assets”文件夹中名为“Resources”的文件夹，以及“Resources”文件夹中的所有子文件夹）都包含在Resource系统的数据中。因此，初始化Resource系统所需的时间与“Resource”文件夹中的文件数量至少呈线性关系。</p>
<p>UnityLoadApplication包含加载和初始化第一个场景的方法。在项目中，这包括把需要在第一个场景里需要显示的所有数据进行反序列化和实例化。比如，编译着色器，上传贴图和实例化GameObjects。另外，第一个场景中，所有继承了MonoBehaviour脚本中的Awake方法都会在这个时候被回调。</p>
<p>这些过程意味着，如果在项目的第一个场景中，在Awake方法中有长时间运行的代码，那么该代码就会增加项目的启动时间。为了避免这一问题，在Awake方法中不能放运行时间长的代码，或者把这些代码放到程序的其他其他生命周期里。</p>
<p><strong>运行时流程分析：</strong></p>
<p>在初始化启动之后的性能分析中，最主要的是PlayerLoop方法。这个是Unity的主循环，并且每一帧都会被执行一次。</p>
<p><img src="../../assets/images/2020-03-04-unity-startup/v2-5c6c95216621d4ab86b26636ff9a019a_720w.jpg" alt="img"></p>
<p>上面的截图来自Unity5.4一个示例项目的性能分析。它展示了PlayerLoop中几个最有趣的方法。请注意，不同Unity版本之间，PlayerLoop中的方法名称可能有所不同。</p>
<p>PlayerRender是运行在Unity渲染系统中的方法。它包括对象剔除，计算动态批次，向GPU提交绘制命令。任何的后处理效果（Image Effects）或基于渲染的脚本回调（比如OnWillRenderObject）也都在这里运行。通常来讲，在具有交互的项目中，这个方法也是最影响GPU性能的。</p>
<p>BaseBehaviourManager调用了三个类型的CommonUpdate方法。它会调用当前场景中，挂在激活的物体上面的Monobehaviours里的特定方法。</p>
<ul>
<li>CommonUpdate<UpdateManager> 回调 Update</li>
<li>CommonUpdate<LateUpdateManager> 回调 LateUpdate</li>
<li>CommonUpdate<FixedUpdateManager> 如果勾选了物理系统，就会回调 FixedUpdate</li>
</ul>
<p>通常，检测BaseBehaviourManager::CommonUpdate<UpdateManager>这类方法是最有趣的，因为它是多数Unity项目脚本运行的入口。</p>
<p>有几个其他的方法也可以注意一下：</p>
<p>如果项目用到了Unity的UI系统，UI::CanvasManager就会回调几个不同的方法。包括Unity UI的批次计算和布局更新，在CanvasManager中，这两个方法也是比较常用并且比较重要的方法。</p>
<p>DelayedCallManager::Update运行协程。这部分内容在之后的”Coroutines”的章节会详细的介绍（如果我能坚持的话，哈哈哈）或者参考官方文档</p>
<p><a href="https://docs.unity3d.com/Manual/BestPracticeUnderstandingPerformanceInUnity3.html" target="_blank" rel="noopener">Unity - Manual: Coroutinesdocs.unity3d.com!</a></p>
<p>PhysicsManager::FixedUpdate执行PhysX物理引擎。它主要涉及到执行PhysX的内部代码，并且也手当前场景中物理对象数量的影响。比如Rigidbodies和Colliders。然而，基于物理的回调也会在OnTriggerStay和OnCollisionStay中出现。</p>
<p>如果项目有用到2D物理系统。那么在Physics2DManager::FixedUpdate中也会出现类似的调用。</p>
<p><strong>脚本方法剖析：</strong></p>
<p>当脚本用IL2CPP编译跨平台编译时，找到包含ScriptingInvocation对象这行。这是Unity为了执行脚本代码，从内部代码过渡到运行时脚本的一个时间点（注意：从技术上讲，通过运行IL2CPP，C#和JS脚本也变成了本地代码。然而，这种编译的代码主要通过IL2CPP运行时框架执行方法，这跟手写的C++代码不太相似）。</p>
<p><img src="../../assets/images/2020-03-04-unity-startup/v2-ddde913f040c5de47824f8abaca2e978_720w.jpg" alt="img"></p>
<p>上面的截图来自一个Unity5.4示例项目中的另一个的性能分析。RuntimeInvoker_Void这一行下面的所有方法都是C#脚本编译的，它们每帧都会被执行一次。</p>
<p>分析报告阅读起来比较容易：每一个都是类名+“_”+方法名。在上图中，我们可以看到EventSysten.Update，PlayerShooting.Update和几个其他的Update方法，这些是大多数MonoBehaviours脚本中比较标准的Unity Update回调。</p>
<p>展开这些方法，可以清楚的看到那些正在占用CPU的方法。其中也会包括项目中被用到的Unity API和C#类库的方法。</p>
<p>上图的分析中，也显示了StandaloneInputModule.Process，这个方法会在每一帧都用射线穿过整个UI，为了检测是否有点击事件或者滑动事件触发。这个对性能的主要影响是需要遍历所有的UI元素，并且监测鼠标的位置是否在UI元素的边界内。</p>
<p><strong>资源加载：</strong></p>
<p>资源加载主要是通过SerializedFile::ReadObject方法来实现的。在对CPU性能分析时，就可以找到这个方法。SerializedFile::ReadObject通过Transfer方法，把文件的二进制数据关联到Unity的序列化系统。所有的Asset类型中，都能找到这个Transfer方法，比如Texttures，MonoBehaviours 和Particle Systems。</p>
<p><img src="../../assets/images/2020-03-04-unity-startup/v2-05563390f8cb569523e89841537c0e8f_720w.jpg" alt="img"></p>
<p>在上面的截图中，一个场景正在被加载。SerializedFile::ReadObject下面调用的不同Transfer方法表明了Unity正在读取并且反序列化场景中所有的Assets。</p>
<p>通常，如果运行时遇到了性能问题，在加载资源时帧率下降，并且通过性能分析是由于SerializedFile::ReadObject这个方法造成的。请注意，在多数情况下，只有当通过SceneManager, Resources 或者 AssetBundle API进行同步加载资源时，SerializedFile::ReadObject才会出现在主线程里。</p>
<p>避免出现这种性能问题，常规的做法是：你可以使用异步加载资源（这就把大量的ReadObject操作丢给了工作线程），或者提前加载好比较大的资源。</p>
<p>注意，当克隆objects时，Transfer也会被调用（在性能分析时出现的CloneObject就是）。如果CloneObject方法下面出现了Transfer方法，这说明资源不是正在从储存器上加载，而是在克隆老的对象。这个过程是：Unity先把老对象序列化，再反序列化数据作为新的对象。</p>
<p>本文翻译自Unity官方文档：</p>
<p><a href="https://docs.unity3d.com/Manual/BestPracticeUnderstandingPerformanceInUnity1.html" target="_blank" rel="noopener">Unity - Manual: Profilingdocs.unity3d.com!</a></p>
<p><strong>Q1：第一次启动项目会有冷启动时间过长的情况，请问该怎么优化？</strong></p>
<blockquote>
<p>首先肯定是判断游戏在冷启动过程中是在做什么事情消耗了时间，然后针对性地优化。还有就是定义好冷启动的界限，从点击游戏到Unity的闪屏出现这段时间通常定义为冷启动的时间，但是我们项目后来发现在做启动的优化的时候还有很长时间花费在游戏启动之后的一些资源初始化方面。</p>
<p>我在优化启动时间的过程中没有使用什么特别多的工具，主要是基于mlogcat.exe查看设备上输出信息的log，结合自己加入的一些log来做问题的排查。</p>
<p>纯粹的冷启动时间过长，会和Resources目录下的资源有关系，越多越慢。我们是以AssetBundle的方式为主，所以这块注意了下，清理了一些插件引入的确定不需要的资源（直接看打包好的apk里的内容来排查）。另外搜索下还有一些文章说相关问题，可以关注下，这里不赘述。</p>
<p><a href="https://blog.csdn.net/qq_34307432/article/details/84023894" target="_blank" rel="noopener">Unity 冷启动简介</a><br><a href="http://gad.qq.com/article/detail/32076" target="_blank" rel="noopener">Unity3D游戏如何加快冷启动时间</a><br><a href="https://www.zhihu.com/question/55441136" target="_blank" rel="noopener">如何改进Unity3d手游启动速度？</a><br><a href="https://www.jianshu.com/p/4366da6dd4a1" target="_blank" rel="noopener">Unity启动耗时优化</a></p>
<p>说一下我们遇到的游戏启动时间过长时解决过的几个问题。我们定义启动时间是从点击app图标到进入游戏Patch界面（即游戏逻辑接管）这段时间。<br>1）Shader编译时长。如果只有游戏安装之后第一次启动时间过长，一个很大的可能是shader编译，之后游戏启动因为有了Cache所以会快很多。这种情况的话建议查看下Always Include的Shader内容和变体，使用shadervariantcollection等方案替代。</p>
<p>2）Tolua绑定和Lua资源加载。这种是每次游戏启动都会有的，ToLua接口绑定需要一定的时间，我们在确保前期不会使用Lua的情况下采用多线程的方式进行绑定和加载，保证主线程不会卡住。</p>
<p>3）注意设置Web请求的超时时长。我们在游戏启动的时候做了一些hook的事情，会有Web请求，后来我们遇到一个情况是在很多机器上会黑屏等待30s甚至60s这样的时长，后来发现是因为这个Web请求没有设置超时时间，于是使用了机器默认的超时时间，在不同设备上不同，比如红米2A上会有接近1分钟的超时限制。这个很坑，只是因为那个非必须的Web服务没有正确开启，导致排查了很长时间。<br>Native层增加界面，减少黑屏等待，提升玩家体验。这个并不能真正解决问题，只是一种缓解手段，等到优化做到位了，其实也就不需要了。<br>说的内容大都是启动时间而非冷启动，供题主参考。建议题主多看看Unity进程的输出log，可能会有意外发现，通常情况下，不使用Resources的方式的话，在没Bug的情况下冷启动时间应该不会很长，我们因为没怎么用这种方式，所以不是很清楚。这个链接可以参考下：<a href="https://www.jianshu.com/p/4366da6dd4a1" target="_blank" rel="noopener">https://www.jianshu.com/p/4366da6dd4a1</a></p>
</blockquote>
<h2 id="脚本编译顺序"><a href="#脚本编译顺序" class="headerlink" title="脚本编译顺序"></a>脚本编译顺序</h2><p>对于大型项目来说，这确实是大家经常遇到的情况。一般来说，Unity Editor会按照脚本的依赖关系编译代码，其主要分为以下四个步骤：<br>编译Standard Assets、Pro Standard Assets和Plugins文件夹中的Runtime Script；<br>编译以上三个文件夹中Editor文件夹下的Script；<br>编译项目中所有剩余的Runtime Script（Editor文件夹以外Script；<br>编译剩余Script（即Editor文件夹中Script）。<br>知道了Unity编辑器的脚本编译特性后，我们则建议研发团队可以将一些长时间不需要改动的脚本代码（比如各种插件代码）放入到Standard Assets、Pro Standard Assets或Plugins文件夹中，这样这些代码只需要编译一次，后续的时间就都能节省下来。有朋友做过测试，在他们的项目中经过上面的改动，原来项目每次的编译时间从23s下降到7s。想想看，这将节省你和你的团队多少时间！</p>
<p><a href="https://docs.unity3d.com/Manual/ScriptCompileOrderFolders.html" target="_blank" rel="noopener">https://docs.unity3d.com/Manual/ScriptCompileOrderFolders.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/unity-2020-03-01-unity-debug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/unity-2020-03-01-unity-debug/" class="post-title-link" itemprop="url">Unity的调试相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-01 08:00:00" itemprop="dateCreated datePublished" datetime="2020-03-01T08:00:00+08:00">2020-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index"><span itemprop="name">unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vs2019-调试unity失效"><a href="#vs2019-调试unity失效" class="headerlink" title="vs2019 调试unity失效"></a>vs2019 调试unity失效</h1><p>s怎么启动调试都无法关联到unity，后来发现自己应该是不小心把attach editor勾选掉了，</p>
<p><img src="../../assets/images/2020-03-01-unity-debug/v2-8a3a1f8d3c6ed7317f18e2ac89620a38_1440w.jpg" alt="img"></p>
<p>注意这里要重启unity才会生效。勾选上之后就可以调试了。</p>
<h1 id="Unity3D-编辑器调试无响应问题"><a href="#Unity3D-编辑器调试无响应问题" class="headerlink" title="Unity3D 编辑器调试无响应问题"></a>Unity3D 编辑器调试无响应问题</h1><p> 使用 VS 在 Unity 编辑器中调试代码，点击 VS 的 <code>附加到 Unity</code>，Unity 编辑器按下 <code>Play</code> 之后，就会一直等待并且无其他响应，只能结束 Unity 进程。</p>
<p><img src="../../assets/images/2020-03-01-unity-debug/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%ADUnity%E6%97%A0%E5%93%8D%E5%BA%94.png" alt="img"></p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><p>经过分析与测试，发现去掉代码中一个单例类的析构方法中的断点即可调试了，具体原因未知。</p>
<p>再测试了一下，在那个单例类的构造、析构方法中分别打断点，如下表：</p>
<table>
<thead>
<tr>
<th>测试</th>
<th>构造</th>
<th>析构</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td></td>
<td></td>
<td>可调试</td>
</tr>
<tr>
<td>2</td>
<td>*</td>
<td></td>
<td>可调试</td>
</tr>
<tr>
<td>3</td>
<td></td>
<td>*</td>
<td>无响应</td>
</tr>
<tr>
<td>4</td>
<td>*</td>
<td>*</td>
<td>无响应</td>
</tr>
</tbody></table>
<blockquote>
<p>表中 <code>*</code> 代表打断点</p>
</blockquote>
<p>可发现只要在那个单例类的析构中打断点就会造成 Unity 无响应。</p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>删除析构方法中的断点，或者所有断点，再调试。</p>
<h1 id="关于如何进行unity远程debugger"><a href="#关于如何进行unity远程debugger" class="headerlink" title="关于如何进行unity远程debugger"></a>关于如何进行unity远程debugger</h1><ul>
<li>首先打开unity的debug模式</li>
</ul>
<p><img src="../../assets/images/2020-03-01-unity-debug/2019-06-21-18-19-45.png" alt=""></p>
<ul>
<li>开启visual sudio中找到attach unity debugger</li>
</ul>
<p><img src="../../assets/images/2020-03-01-unity-debug/2019-06-21-18-20-01.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/unity-2020-02-20-shader-lost/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/unity-2020-02-20-shader-lost/" class="post-title-link" itemprop="url">unity 移动平台打包丢失shader的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-20 08:00:00" itemprop="dateCreated datePublished" datetime="2020-02-20T08:00:00+08:00">2020-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index"><span itemprop="name">unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>自己写了个shader，并且是从代码里面来进行加载，编辑器中并没有引用。在编辑器中运行项目没有问题，但是当我发布到iso和android平台之后发现游戏中并不能找到我自己的shader，猜想是unity在打包过程中进行了一些优化，没有用到的shader不会被打到游戏包内。</p>
<p>我找到了2个解决办法</p>
<p>1.随意创建一个物体并添加使用了此shader的材质。并不推荐此方法，正确的方法应该是第二种。</p>
<p>2.在GraphicsSettings中添加上此shader：</p>
<p>选择Edit-&gt;ProjectSettings-&gt;Graphics （不同的unity版本可能有所不同，我的版本是5.6）</p>
<p>将shader拖入到Always Included Shaders数组中：</p>
<p><img src="../../assets/images/2020-02-20-shader-lost/20180309110801448.png" alt="img"></p>
<p><img src="../../assets/images/2020-02-20-shader-lost/20180309110915442.png" alt="img"></p>
<p>这样我们重新打包之后，就可以正常找到shader了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.igiven.com/unity-2020-02-19-UnderstandingAutomaticMemoryManagement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhepama">
      <meta itemprop="description" content="一个不专业的程序员,写着不专业的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IGiven">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/unity-2020-02-19-UnderstandingAutomaticMemoryManagement/" class="post-title-link" itemprop="url">理解自动内存管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-19 08:00:00" itemprop="dateCreated datePublished" datetime="2020-02-19T08:00:00+08:00">2020-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-16 12:32:55" itemprop="dateModified" datetime="2020-07-16T12:32:55+08:00">2020-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index"><span itemprop="name">unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>当创建对象、字符串或数组时，存储它所需的内存将从称为堆的中央池中分配。当项目不再使用时，它曾经占用的内存可以被回收并用于别的东西。在过去，通常由程序员通过适当的函数调用明确地分配和释放这些堆内存块。如今，像Unity的Mono引擎这样的运行时系统会自动为您管理内存。自动内存管理需要比显式分配/释放更少的编码工作，并大大降低内存泄漏（内存被分配但从未随后释放的情况）的可能性。</p>
<h2 id="值类型和引用类型"><a href="#值类型和引用类型" class="headerlink" title="值类型和引用类型"></a>值类型和引用类型</h2><p>当调用一个函数时，它的参数值将被复制到一个保留特定调用的内存区域。只占用几个字节的数据类型可以非常快速方便地复制。然而，对象、字符串和数组要大得多，如果这些类型的数据被定期复制，那将是非常低效的。幸运的是，这是不必要的；大项目的实际存储空间是从堆中分配的，一个小的“指针”值用来记住它的位置。从那时起，只有指针在参数传递过程中需要被复制。只要运行时系统能够定位指针标识的项，就可以经常使用数据的一个副本。<br>在参数传递期间直接存储和复制的类型称为值类型。这些包括整数，浮点数，布尔和Unity的结构类型（例如Color和Vector3）。分配在堆上然后通过指针访问的类型称为引用类型，因为存储在变量中的值仅仅是“引用”到真实数据。引用类型的示例包括对象，字符串和数组。</p>
<h2 id="内存分配和垃圾收集"><a href="#内存分配和垃圾收集" class="headerlink" title="内存分配和垃圾收集"></a>内存分配和垃圾收集</h2><p>内存管理器跟踪它知道未被使用的堆中的区域。当请求一个新的内存块时（例如当一个对象被实例化时），管理器选择一个未使用的区域，从中分配该块，然后从已知的未使用的空间中移除分配的内存。后续请求以相同的方式处理，直到没有足够大的空闲区域分配所需的块大小。在这一点上，从堆中分配的所有内存仍然在使用中是非常不可能的。只要还存在可以找到它的引用变量，就只能访问堆上的引用项。如果对内存块的所有引用都消失了（即，引用变量已被重新分配，或者它们是现在超出范围的局部变量），则它占用的内存可以安全地重新分配。<br>为了确定哪些堆块不再被使用，内存管理器会搜索所有当前活动的引用变量，并将它们所指的块标记为<code>live</code>。在搜索结束时，内存管理器认为这些<code>live</code>块之间的任何空间都是空的，并且可用于后续分配。由于显而易见的原因，定位和释放未使用的内存的过程被称为垃圾回收（或简称GC）。</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>垃圾收集对程序员来说是自动的、不可见的，但是收集过程实际上需要大量的CPU时间。如果正确使用，自动内存管理通常会等于或击败手动分配的整体性能。但是，对于程序员来说，重要的是要避免那些比实际需要触发更多次收集器和在执行中引入暂停的错误。有一些臭名昭著的算法，可能是GC噩梦，尽管他们乍一看是无辜的。重复字符串连接是一个典型的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;C# script example</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class ExampleScript : MonoBehaviour &#123;</span><br><span class="line">    void ConcatExample(int[] intArray) &#123;</span><br><span class="line">        string line &#x3D; intArray[0].ToString();</span><br><span class="line">        </span><br><span class="line">        for (i &#x3D; 1; i &lt; intArray.Length; i++) &#123;</span><br><span class="line">            line +&#x3D; &quot;, &quot; + intArray[i].ToString();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;JS script example</span><br><span class="line">function ConcatExample(intArray: int[]) &#123;</span><br><span class="line">    var line &#x3D; intArray[0].ToString();</span><br><span class="line">    </span><br><span class="line">    for (i &#x3D; 1; i &lt; intArray.Length; i++) &#123;</span><br><span class="line">        line +&#x3D; &quot;, &quot; + intArray[i].ToString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return line;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的关键细节是，新的部分不会被一个接一个地添加到字符串中。实际情况是，每次循环<code>line</code>变量的前一个内容都会变死——一个完整的新字符串被分配到包含原来的部分，再在最后加上新的部分。由于字符串随着<code>i</code>值的增加而变得更长，所以所消耗的堆空间数量也增加了，因此每次调用这个函数时都很容易消耗数百字节的空闲堆空间。如果你需要连接多个字符串，那么一个更好的选择是Mono库的<a href="https://msdn.microsoft.com/en-gb/library/system.text.stringbuilder.aspx" target="_blank" rel="noopener">System.Text.StringBuilder</a>类。然而，即使反复连接也不会引起太多麻烦，除非它被频繁调用，而在Unity中通常意味着帧更新。就像是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;C# script example</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class ExampleScript : MonoBehaviour &#123;</span><br><span class="line">    public GUIText scoreBoard;</span><br><span class="line">    public int score;</span><br><span class="line">    </span><br><span class="line">    void Update() &#123;</span><br><span class="line">        string scoreText &#x3D; &quot;Score: &quot; + score.ToString();</span><br><span class="line">        scoreBoard.text &#x3D; scoreText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;JS script example</span><br><span class="line">var scoreBoard: GUIText;</span><br><span class="line">var score: int;</span><br><span class="line"></span><br><span class="line">function Update() &#123;</span><br><span class="line">    var scoreText: String &#x3D; &quot;Score: &quot; + score.ToString();</span><br><span class="line">    scoreBoard.text &#x3D; scoreText;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>…每次调用Update将分配新字符串，并不断生成的新垃圾。大多数情况下，只有当分数变化时才更新文本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;C# script example</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class ExampleScript : MonoBehaviour &#123;</span><br><span class="line">    public GUIText scoreBoard;</span><br><span class="line">    public string scoreText;</span><br><span class="line">    public int score;</span><br><span class="line">    public int oldScore;</span><br><span class="line">    </span><br><span class="line">    void Update() &#123;</span><br><span class="line">        if (score !&#x3D; oldScore) &#123;</span><br><span class="line">            scoreText &#x3D; &quot;Score: &quot; + score.ToString();</span><br><span class="line">            scoreBoard.text &#x3D; scoreText;</span><br><span class="line">            oldScore &#x3D; score;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;JS script example</span><br><span class="line">var scoreBoard: GUIText;</span><br><span class="line">var scoreText: String;</span><br><span class="line">var score: int;</span><br><span class="line">var oldScore: int;</span><br><span class="line"></span><br><span class="line">function Update() &#123;</span><br><span class="line">    if (score !&#x3D; oldScore) &#123;</span><br><span class="line">        scoreText &#x3D; &quot;Score: &quot; + score.ToString();</span><br><span class="line">        scoreBoard.text &#x3D; scoreText;</span><br><span class="line">        oldScore &#x3D; score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当函数返回数组值时，会发生另一个潜在的问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;C# script example</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class ExampleScript : MonoBehaviour &#123;</span><br><span class="line">    float[] RandomList(int numElements) &#123;</span><br><span class="line">        var result &#x3D; new float[numElements];</span><br><span class="line">        </span><br><span class="line">        for (int i &#x3D; 0; i &lt; numElements; i++) &#123;</span><br><span class="line">            result[i] &#x3D; Random.value;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;JS script example</span><br><span class="line">function RandomList(numElements: int) &#123;</span><br><span class="line">    var result &#x3D; new float[numElements];</span><br><span class="line">    </span><br><span class="line">    for (i &#x3D; 0; i &lt; numElements; i++) &#123;</span><br><span class="line">        result[i] &#x3D; Random.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当创建一个充满值的新数组时，这种函数非常优雅和方便。但是，如果反复调用，那么每次都会分配新的内存。由于数组可能非常大，可用空间可能会迅速消耗，从而导致垃圾收集频繁。避免这个问题的一个方法是利用数组是引用类型的事实。作为参数传递给函数的数组可以在该函数内修改，结果将在函数返回后保留。<br>像上面这样的功能通常可以被替换成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;C# script example</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class ExampleScript : MonoBehaviour &#123;</span><br><span class="line">    void RandomList(float[] arrayToFill) &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; arrayToFill.Length; i++) &#123;</span><br><span class="line">            arrayToFill[i] &#x3D; Random.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;JS script example</span><br><span class="line">function RandomList(arrayToFill: float[]) &#123;</span><br><span class="line">    for (i &#x3D; 0; i &lt; arrayToFill.Length; i++) &#123;</span><br><span class="line">        arrayToFill[i] &#x3D; Random.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这只是用新值替换数组的现有内容。虽然这需要在调用代码中完成数组的初始分配（这似乎有些不雅），但是在调用该函数时不会产生任何新的垃圾。</p>
<h2 id="主动请求垃圾收集"><a href="#主动请求垃圾收集" class="headerlink" title="主动请求垃圾收集"></a>主动请求垃圾收集</h2><p>如上所述，最好尽量避免分配。然而，鉴于它们不能被完全消除，您可以使用两种主要策略来最大限度地减少其入侵游戏：</p>
<h3 id="小堆垃圾收集快速可频繁收集"><a href="#小堆垃圾收集快速可频繁收集" class="headerlink" title="小堆垃圾收集快速可频繁收集"></a>小堆垃圾收集快速可频繁收集</h3><p>这个策略通常最适合长期游戏的游戏，其中平滑的帧速率是主要的关注点。这样的游戏通常会频繁地分配小块，但这些块将仅在短时间内使用。在iOS上使用此策略时，典型的堆大小约为200KB，iPhone 3G上的垃圾收集大约需要5ms。如果堆增加到1MB，则收集大约需要7ms。因此，有时候可以以规则的帧间隔请求垃圾回收。这通常会使垃圾收集发生的次数比严格的需要的更多，但是它们将被快速处理，对游戏的影响最小：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (Time.frameCount % 30 &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">   System.GC.Collect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，您应该谨慎使用此技术，并检查profiler统计信息，以确保它真正减少了游戏的收集时间。</p>
<h3 id="大堆垃圾收集缓慢且不可频繁收集"><a href="#大堆垃圾收集缓慢且不可频繁收集" class="headerlink" title="大堆垃圾收集缓慢且不可频繁收集"></a>大堆垃圾收集缓慢且不可频繁收集</h3><p>这个策略对于分配（和因此收集）相对不频繁并可以在游戏暂停期间处理的游戏最适用。对于堆来说，尽可能大，而不是因为系统内存太少而导致操作系统杀死你的应用程序。但是，如果可能，Mono运行时会自动避免扩展堆。您可以通过在启动期间预先分配一些占位符空间来手动扩展堆（即，您实例化一个纯粹用于对内存管理器产生影响的“无用”对象）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;C# script example</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class ExampleScript : MonoBehaviour &#123;</span><br><span class="line">    void Start() &#123;</span><br><span class="line">        var tmp &#x3D; new System.Object[1024];</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; make allocations in smaller blocks to avoid them to be treated in a special way, which is designed for large blocks</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 1024; i++)</span><br><span class="line">            tmp[i] &#x3D; new byte[1024];</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; release reference</span><br><span class="line">        tmp &#x3D; null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;JS script example</span><br><span class="line">function Start() &#123;</span><br><span class="line">    var tmp &#x3D; new System.Object[1024];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; make allocations in smaller blocks to avoid them to be treated in a special way, which is designed for large blocks</span><br><span class="line">        for (var i : int &#x3D; 0; i &lt; 1024; i++)</span><br><span class="line">        tmp[i] &#x3D; new byte[1024];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; release reference</span><br><span class="line">        tmp &#x3D; null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个足够大的堆不应该在游戏中的暂停期间完全被填满，这样可以容纳一次收集。当发生这样的暂停时，您可以显式地请求垃圾收集：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.GC.Collect();</span><br></pre></td></tr></table></figure>

<p>同样，在使用此策略时应该小心，并注意Profiler统计数据，而不是仅仅假定它具有所期望的效果。</p>
<h2 id="可重复使用的对象池"><a href="#可重复使用的对象池" class="headerlink" title="可重复使用的对象池"></a>可重复使用的对象池</h2><p>很多情况下，只要减少创建和销毁对象的数量，就可以避免生成垃圾。游戏中存在着某些类型的物体，如抛射体，尽管一次只会有少量的物体在游戏中，但它们可能会被反复地遇到。在这种情况下，常常可以重用对象，而不是破坏旧对象，并用新的对象替换它们。</p>
<h2 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h2><p>内存管理是一个微妙而复杂的课题，它已经投入了大量的学术研究。如果您有兴趣了解更多信息，那么<a href="http://www.memorymanagement.org/" target="_blank" rel="noopener">memorymanagement.org</a>是一个很好的资源，列出了许多出版物和在线文章。有关对象池的更多信息可以在<a href="https://en.wikipedia.org/wiki/Object_pool_pattern" target="_blank" rel="noopener">维基百科页面</a>和<a href="https://sourcemaking.com/design_patterns/object_pool" target="_blank" rel="noopener">Sourcemaking.com</a>上找到。</p>
<blockquote>
<p>原文链接：<a href="https://docs.unity3d.com/Manual/UnderstandingAutomaticMemoryManagement.html" target="_blank" rel="noopener">Understanding Automatic Memory Management</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhepama</p>
  <div class="site-description" itemprop="description">一个不专业的程序员,写着不专业的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhepama" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhepama" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhepama@gmail.com" title="E-Mail → mailto:zhepama@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.godgodgame.com/" title="http:&#x2F;&#x2F;www.godgodgame.com" rel="noopener" target="_blank">GODGODGAME</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.igiven.com/" title="https:&#x2F;&#x2F;www.igiven.com">IGIVEN</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhepama</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
